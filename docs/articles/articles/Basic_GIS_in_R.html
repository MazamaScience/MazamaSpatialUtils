<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic GIS Operations in R • MazamaSpatialUtils</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Basic GIS Operations in R">
<meta property="og:description" content="MazamaSpatialUtils">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">MazamaSpatialUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/MazamaSpatialUtils.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../../articles/Understanding_sp_Objects.html">Understanding sp Objects</a>
    </li>
    <li>
      <a href="../../articles/articles/Basic_GIS_in_R.html">Basic GIS Operations in R</a>
    </li>
    <li>
      <a href="../../articles/articles/ebolamap.html">Ebola Map Example</a>
    </li>
    <li>
      <a href="../../articles/available-data.html">Available Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/MazamaSpatialUtils/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Basic_GIS_in_R_files/header-attrs-2.5/header-attrs.js"></script><link href="Basic_GIS_in_R_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Basic_GIS_in_R_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic GIS Operations in R</h1>
                        <h4 class="author">Roger Andre, Mazama Science</h4>
            
            <h4 class="date">March 9, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/MazamaSpatialUtils/blob/master/vignettes/articles/Basic_GIS_in_R.Rmd"><code>vignettes/articles/Basic_GIS_in_R.Rmd</code></a></small>
      <div class="hidden name"><code>Basic_GIS_in_R.Rmd</code></div>

    </div>

    
    
<div id="objective" class="section level2">
<h2 class="hasAnchor">
<a href="#objective" class="anchor"></a>Objective</h2>
<p>The goal of this document is to show how basic spatial operations common to Geographic Information Systems (GIS) can be done in R using S4 objects and the <em>sp</em> and <em>raster</em> packages. I have chosen to focus on vector data, specifically point and polygon sets, as those are the ones most commonly encountered when using the MazamaSpatialUtils.</p>
</div>
<div id="creating-spatial-polygon-data-frames" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-spatial-polygon-data-frames" class="anchor"></a>Creating Spatial Polygon Data Frames</h2>
<p>An easy way to create a rectangular Spatial Polygon Data Frame is to use the Bounding Box, or extent, of another spatial feature to define the geometry of the feature you want to create. A separate data frame with feature attributes can then be attached to this geometry to form a SpatialPolygonsDataFrame.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>

<span class="co"># polygon A</span>
<span class="va">poly_a</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fl">2.0</span>, <span class="fl">11.0</span>, <span class="fl">9.0</span>, <span class="fl">15.0</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="va">df_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"A"</span>, id <span class="op">=</span> <span class="st">"1"</span>, county <span class="op">=</span> <span class="st">"1"</span>, type <span class="op">=</span> <span class="st">"tract"</span>, zone <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span>

<span class="va">spdf_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPolygons.html">SpatialPolygonsDataFrame</a></span><span class="op">(</span><span class="va">poly_a</span>,<span class="va">df_a</span><span class="op">)</span></code></pre></div>
<p>If multiple features are present, it’s possible to bind them all into a single multiploygon feature. Here 4 separate polygons; <em>“spdf_a”, “spdf_b”, “spdf_c”</em> and <em>“spdf_d”</em> are combined into a single new feature named <em>“spdf_abcd”</em>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define a coordinate reference system to use on all features</span>
<span class="va">grs80</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html">CRS</a></span><span class="op">(</span><span class="st">"+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0 +units=m"</span><span class="op">)</span>

<span class="co"># "Bind" Polys A,B,C &amp; D into one multipolygon SPDF</span>
<span class="va">spdf_abcd</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/bind.html">bind</a></span><span class="op">(</span><span class="va">spdf_a</span>, <span class="va">spdf_b</span>, <span class="va">spdf_c</span>, <span class="va">spdf_d</span>, keepnames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">proj4string</a></span><span class="op">(</span><span class="va">spdf_abcd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">grs80</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">proj4string</a></span><span class="op">(</span><span class="va">spdf_e</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">grs80</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">spdf_abcd</span><span class="op">)</span></code></pre></div>
<pre><code>## Object of class SpatialPolygonsDataFrame
## Coordinates:
##   min max
## x   2  20
## y   2  15
## Is projected: FALSE 
## proj4string : [+proj=longlat +datum=NAD83 +no_defs]
## Data attributes:
##      name                id               county              type          
##  Length:4           Length:4           Length:4           Length:4          
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##      zone          
##  Length:4          
##  Class :character  
##  Mode  :character</code></pre>
<p>Note that a CRS has been assigned to the new feature. This is needed in order to do spatial comparisons bewteen this feature and others later on.</p>
</div>
<div id="creating-spatial-points-data-frames" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-spatial-points-data-frames" class="anchor"></a>Creating Spatial Points Data Frames</h2>
<p>There are multiple ways in which points can be converted into Spatial Point Data Frames.<br>
They share the same basic idea though - take a regular data frame which contains X and Y values that define point coordinates and then convert it into a <code>SpatialPointsDataFrame</code> using the <em>sp</em> package. Two ways are shown below. In both cases, a data frame is used to define the point locations and attributes of the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a data frame with coordinates and some data, temperature readings, perhaps...</span>
<span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, text <span class="op">=</span> <span class="st">"
id  x  y  temp
 1  5  21 50
 2  18 20 49.5
 3  9  13 52
 4  17 13 51
 5  7  12  53
 6  23 12 50
 7  12 11 52
 8  6  7  57
 9  10 7  57
 10 15 7  55
 11 16 3  54
 12 22 3  54"</span><span class="op">)</span></code></pre></div>
<div id="method-1" class="section level3">
<h3 class="hasAnchor">
<a href="#method-1" class="anchor"></a>Method 1</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract the x and y coordinates as a separate vector</span>
<span class="va">xy</span> <span class="op">&lt;-</span> <span class="va">temp_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Convert the point df into a SpatialPointsDataFrame</span>
<span class="va">temp_spdf</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPointsDataFrame</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="va">xy</span>, 
                                    data <span class="op">=</span> <span class="va">temp_df</span>,
                                    proj4string <span class="op">=</span> <span class="va">grs80</span><span class="op">)</span>
<span class="va">temp_spdf</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">temp_spdf</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">temp_spdf</span><span class="op">)</span></code></pre></div>
<pre><code>## Object of class SpatialPointsDataFrame
## Coordinates:
##   min max
## x   5  23
## y   3  21
## Is projected: FALSE 
## proj4string : [+proj=longlat +datum=NAD83 +no_defs]
## Number of points: 12
## Data attributes:
##       id                  x               y              temp      
##  Length:12          Min.   : 5.00   Min.   : 3.00   Min.   :49.50  
##  Class :character   1st Qu.: 8.50   1st Qu.: 7.00   1st Qu.:50.75  
##  Mode  :character   Median :13.50   Median :11.50   Median :52.50  
##                     Mean   :13.33   Mean   :10.75   Mean   :52.88  
##                     3rd Qu.:17.25   3rd Qu.:13.00   3rd Qu.:54.25  
##                     Max.   :23.00   Max.   :21.00   Max.   :57.00</code></pre>
</div>
<div id="method-2" class="section level3">
<h3 class="hasAnchor">
<a href="#method-2" class="anchor"></a>Method 2</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use the coordinates() function to define the coordinate fields</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="va">y</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">grs80</span>

<span class="va">temp_df</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span></code></pre></div>
<pre><code>## Object of class SpatialPointsDataFrame
## Coordinates:
##   min max
## x   5  23
## y   3  21
## Is projected: FALSE 
## proj4string : [+proj=longlat +datum=NAD83 +no_defs]
## Number of points: 12
## Data attributes:
##       id                 temp      
##  Length:12          Min.   :49.50  
##  Class :character   1st Qu.:50.75  
##  Mode  :character   Median :52.50  
##                     Mean   :52.88  
##                     3rd Qu.:54.25  
##                     Max.   :57.00</code></pre>
<p>Method 2 converts the data frame in place and in doing so, the columns with the coordinate values are moved out of the <code>@data</code> slot. This can be advantageous if you don’t need the coordinates for anything more than to define the point geometry.</p>
</div>
</div>
<div id="basic-plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-plotting" class="anchor"></a>Basic Plotting</h2>
<p>Now that we have some features created, what do they look like? The basic <code><a href="https://rdrr.io/pkg/raster/man/plot.html">plot()</a></code> function works extremely well with S4 Spatial objects. One thing to keep in mind, though, is that the first feature plotted defines the plot extents. One way to take advantage of this is to create a “map area” feature which can be used to both center subsequent plots and also to define a neatline for the map.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># bbox (just needed to be able to plot 2 objects that don't share the same bbox)</span>
<span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">27.0</span>, <span class="fl">0</span>, <span class="fl">27.0</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>

<span class="co"># Invisible bbox to set the plot extent</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">bbox</span>, col <span class="op">=</span> <span class="st">"transparent"</span>, border <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>

<span class="co"># Plot polygon features and label them</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">spdf_e</span>, col <span class="op">=</span> <span class="st">"lightgreen"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">spdf_abcd</span>, col <span class="op">=</span> <span class="st">"pink"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/text.html">text</a></span><span class="op">(</span><span class="va">spdf_abcd</span>, labels <span class="op">=</span> <span class="va">spdf_abcd</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/text.html">text</a></span><span class="op">(</span><span class="va">spdf_e</span>, labels <span class="op">=</span> <span class="va">spdf_e</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>

<span class="co"># Plot the points and label them</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">temp_spdf</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"black"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
<span class="co"># Label the points</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/text.html">text</a></span><span class="op">(</span><span class="va">temp_spdf</span>, labels <span class="op">=</span> <span class="va">temp_spdf</span><span class="op">$</span><span class="va">id</span>, pos <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="co"># Overplot the bbox as a neatline</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">bbox</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="Basic_GIS_in_R_files/figure-html/basic_plot-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="basic-spatial-analysis-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-spatial-analysis-operations" class="anchor"></a>Basic Spatial Analysis Operations</h2>
<p>Generally speaking, there are 5 operations commonly performed while doing spatial analysis. (Taken from <a href="https://www.lib.umd.edu/binaries/content/assets/public/gov-info-gis/research-and-instruction/spatial-analysis-workbook.pdf">5 common ArcToolbox Tools</a> section of online paper by Univ. or Maryland.)</p>
<ol style="list-style-type: decimal">
<li>Buffer</li>
<li>Clip</li>
<li>Intersect</li>
<li>Dissolve</li>
<li>Spatial Join</li>
</ol>
<p>The <em>raster</em> and <em>sp</em> packages provide all the functionality needed to perform these operations.</p>
</div>
<div id="buffer" class="section level2">
<h2 class="hasAnchor">
<a href="#buffer" class="anchor"></a>Buffer</h2>
<p>The <em>raster::buffer()</em> function buffers a specific distance away from a feature or group of features. It uses the units of the map projection as the units for the buffer distance. Often a buffer is used to define a zone around a specific point. Here, we will create a 500,000 meter buffer around the <em>temp_df</em> point feature with “id = 4”.</p>
<pre><code># Subset a single point out of set
point_4 &lt;- subset(temp_df, id == 4)

# Buffer around the point
buffer_zone &lt;- raster::buffer(point_4, width = 500000)

# plot the buffer
plot(buffer_zone, col = "gray", add = TRUE)

# plot the point
plot(point_4, add = TRUE, col = "black", pch = 16)
text(point_4, labels = point_4$id, pos = 3)</code></pre>
<p><img src="Basic_GIS_in_R_files/figure-html/buffer_points-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="clip" class="section level2">
<h2 class="hasAnchor">
<a href="#clip" class="anchor"></a>Clip</h2>
<p>Clipping works a bit like a cookie-cutter. It is done using the <em>raster::intersect()</em> function which takes an input geometry and calculates the spatial intersection with another geometry. Here we will clip the pink “spdf_abcd” feature and the green “spdf_e” feature with the “buffer_zone” we created above.</p>
<pre><code># Clip the features
abcd_clip &lt;- raster::intersect(spdf_abcd, buffer_zone)
e_clip &lt;- raster::intersect(spdf_e, buffer_zone)

# Plot the new clipped features
plot(e_clip, col = "lightgreen", add = TRUE)
plot(abcd_clip, col = "pink", add = TRUE)

# plot the point
plot(point_4, add = TRUE, col = "black", pch = 16)
text(point_4, labels = point_4$id, pos = 3)</code></pre>
<p><img src="Basic_GIS_in_R_files/figure-html/clip_region-1.png" width="672" style="display: block; margin: auto;"></p>
<p>It is very important to note that the new "_clip" features contain all of the attributes which were contained in the “spdf_abcd” and “spdf_e” SpatialPolygonsDataFrames. In other words, the feature that was clipped retained all of its original attribute information.</p>
<pre><code><a href="https://rdrr.io/pkg/raster/man/headtail.html">head(abcd_clip@data)
##   name id county  type zone
## 1    B  2      1 tract    1
## 2    C  3      1 tract    2

head(e_clip@data)
##   name id county   type
## 1    E  1      2 forest</a></code></pre>
<p>This is ONLY because the “buffer_zone” (clipping) feature lacked a data frame of its own and was simply a SpatialPolygon object, and not a SpatialPolygonsDataFrame.</p>
<pre><code>summary(buffer_zone)

Object of class SpatialPolygons
Coordinates:
        min      max
x 12.390806 21.60919
y  8.479751 17.51868
Is projected: FALSE 
proj4string :
[+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0 +units=m]</code></pre>
<p>The behavior of the <em>raster::intersect()</em> function is very different when both features are SpatialPolygonsDataFrames. When 2 SpatialPolygonsDataFrames are intersected, the default behavior of the <em>raster::intersect()</em> function is to combine the attributes from both data sets. Which brings us to the next type of operation.</p>
</div>
<div id="intersection" class="section level2">
<h2 class="hasAnchor">
<a href="#intersection" class="anchor"></a>Intersection</h2>
<p>The intersection operation computes the spatial intersection between 2 features and returns a new geometry that is this intersection area. It also combines the feature attributes of both features. In the example below, we are intersecting the 2 clipped features with each other. Note the attributes and the geometry that are returned. Unsurprisingly, this is also done with the <em>raster::intersect()</em> function.</p>
<pre><code>combined_clips &lt;- raster::intersect(abcd_clip, e_clip)
head(combined_clips@data)

##   name.1 id.1 county.1 type.1 zone name.2 id.2 county.2 type.2
## 1      B    2        1  tract    1      E    1        2 forest
## 2      C    3        1  tract    2      E    1        2 forest</code></pre>
<p><img src="Basic_GIS_in_R_files/figure-html/spdf_intersection-1.png" width="672" style="display: block; margin: auto;"></p>
<p>If we look at just the attributes from “abcd_clip” (which was created in the “Clip” section above) we see that it only contains attributes from the original “spdf_abcd” feature set.</p>
<p>This behavior is consistent with how the intersection tool works in other systems and in fact, here is a description of the difference between the “clip” and “intersection” functions in ArcGIS.</p>
<blockquote>
<p>What’s the <strong>difference between</strong> the <strong>clip</strong> tool and the <strong>intersect</strong> tool? The main <strong>difference is</strong> the resulting attributes. When you run the <strong>clip</strong> tool, only the input features attributes will be <strong>in the</strong> output. When you use the <strong>intersect</strong> tool, the attributes from all features will be <strong>in the</strong> output.</p>
</blockquote>
<p>When performing clipping operations with 2 SpatialPolygonsDataFrame features, it may be useful to create your own function which modifies the contents of the returned data frame to match the definition listed above.</p>
<div id="intersection-1" class="section level3">
<h3 class="hasAnchor">
<a href="#intersection-1" class="anchor"></a>!Intersection</h3>
<p>While this isn’t listed as one of the 5 basic operations, I include it here because I think it’s important and not generally easy to find a solution for. Very often what we want is to compute the difference between 2 spatial features, rather than the area of intersection. For example, in the clipped regions we’ve created above, the “e_clip” region is a full disk that extends behind the “abcd_clip” region.</p>
<p>If we only wanted the region of “e_clip” that DOESN’T intersect with “abcd_clip”, it’s very R-like and easy to obtain that by subtracting one from the other.</p>
<pre><code># Subtract abcd_clip geometry from e_clip geometry
disjoint_e_clip &lt;- (e_clip - abcd_clip) 

plot(disjoint_e_clip, col = "lightgreen", add = TRUE)</code></pre>
<p><img src="Basic_GIS_in_R_files/figure-html/spdf_disjoint-1.png" width="672" style="display: block; margin: auto;"> As an added bonus, we retain the original attributes as well.</p>
<pre><code><a href="https://rdrr.io/pkg/raster/man/headtail.html">head(disjoint_e_clip@data)

##   name id county   type
## 1    E  1      2 forest</a></code></pre>
</div>
</div>
<div id="dissolve" class="section level2">
<h2 class="hasAnchor">
<a href="#dissolve" class="anchor"></a>Dissolve</h2>
<p>The Dissolve operation is a form of spatial aggregation in which the internal borders of a feature set are removed, or dissolved, leaving larger regions behind that are the result of aggregating by a specific value. This aggregation value is usually defined by a column in the data set. Appropriately enough, the function that does this for us is named <em>raster::aggregate()</em>.</p>
<p>Our original “spdf_abcd” data set contains a “zone” field that we can use to dissolve the features with.</p>
<pre><code><a href="https://rdrr.io/pkg/raster/man/headtail.html">head(spdf_abcd@data)

##     name id county  type zone
## 1.1    A  1      1 tract    1
## 1.2    B  2      1 tract    1
## 1.3    C  3      1 tract    2
## 1.4    D  4      1 tract    2</a></code></pre>
<p>We can see the way that the zones are situated in the left plot below. When we dissolve the features using the “zone” as the aggregation feature, we get the result in the plot on the right.</p>
<pre><code>zoned_tracts &lt;- raster::aggregate(spdf_abcd, by='zone')</code></pre>
<p><img src="Basic_GIS_in_R_files/figure-html/dissolve-1.png" width="672"> Most common dissolve tools will leave the field behind that was used to do the aggregation, in this case the “zone” attribute. The <em>raster::aggregate</em> function has some nice additional functionality in that it can also include other fields as well. These can be aggregated in various ways, such as by selecting the 1st entry, or by calulating the mean value.</p>
<p>Below we dissolve the data set by the “zone” field and then aggregate the “type” and “county” fields by keeping their 1st values in the set. We also calculate the mean of the “id” field for the 2 values in each “zone”.</p>
<pre><code>spdf_abcd@data$id &lt;- as.numeric(spdf_abcd@data$id)

zoned_tracts &lt;- raster::aggregate(spdf_abcd, 
                                  by='zone', 
                                  sums=list(
                                    list(function(x) x[1], c('type','county')),
                                    list(function(x) mean(x), c('id'))
                                    )
                                  )</code></pre>
<p>So we go from this,</p>
<pre><code>##     name id county  type zone
## 1.1    A  1      1 tract    1
## 1.2    B  2      1 tract    1
## 1.3    C  3      1 tract    2
## 1.4    D  4      1 tract    2</code></pre>
<p>to this.</p>
<pre><code>##   zone  type county  id
## 1    1 tract      1 1.5
## 2    2 tract      1 3.5</code></pre>
<p>This can be exceptionally useful.</p>
</div>
<div id="spatial-join" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-join" class="anchor"></a>Spatial Join</h2>
<p>The Spatial Join operation is one where tabular data from one data set is attached to another based on spatial context. This functionality is provided by the <em>sp::over</em> function.</p>
<p>In our data, let’s say that we want to assign the mean temperature value from the point data to each polygon that contains temperature values. Here is how we do that.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poly_temp_df</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/over.html">over</a></span><span class="op">(</span><span class="va">spdf_abcd</span>, <span class="va">temp_spdf</span><span class="op">[</span>,<span class="st">"temp"</span><span class="op">]</span>,  fn <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>

<span class="co"># Create a new column in the original data set with the new values</span>
<span class="va">spdf_abcd</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">poly_temp_df</span><span class="op">$</span><span class="va">temp</span></code></pre></div>
<p><img src="Basic_GIS_in_R_files/figure-html/spatial_join-1.png" width="672"></p>
<p>Note that <em>sp::over()</em> returns a data frame with the same number of rows as the input feature and attribute data from the feature being unioned. Since here we requested that the “temp” data be aggregated by mean, we get back a table of mean temperatures for each polygon.</p>
<pre><code>##     temp
## 1.1 52.5
## 1.2 51.5
## 1.3 54.5
## 1.4 57.0</code></pre>
<p>If we join this data back to the input feature, we get something that looks like this.</p>
<pre><code>##     name id county  type zone temp
## 1.1    A  1      1 tract    1 52.5
## 1.2    B  2      1 tract    1 51.5
## 1.3    C  3      1 tract    2 54.5
## 1.4    D  4      1 tract    2 57.0</code></pre>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>As we can see, all standard GIS operations can be done in R using <em>sp</em> and <em>raster</em> on S4 spatial objects. Care should be taken to determine what type of object the function returns, as the behavior changes based on the input types. Also, as mentioned briefly at the beginning of the documnt, all spatial features should be assigned a common Coordinate Reference System (CRS) for thes tools to work properly. Aside from these cautions, the functions perform very well and are analogous to those found in other GIS packages.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Rachel Carroll, Eli Grosman, Roger Andre, Tom Bergamaschi, Tina Chen, Ruby Fore, Will Leahy, Helen Miller, Henry Nguyen, Robin Winstanley, Alice Yang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
