<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ebola Map Example • MazamaSpatialUtils</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Ebola Map Example">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">MazamaSpatialUtils</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/MazamaSpatialUtils.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/examples/ebolamap.html">Ebola Map Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/MazamaSpatialUtils">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Ebola Map Example</h1>
                        <h4 class="author">Robin Winstanley</h4>
            
            <h4 class="date">July 14, 2015</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/MazamaSpatialUtils/blob/master/vignettes/examples/ebolamap.Rmd"><code>vignettes/examples/ebolamap.Rmd</code></a></small>
      <div class="hidden name"><code>ebolamap.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>The Ebola Map described in the following was created as a response to a map seen online, created by <a href="http://www.johnstonsarchive.net/policy/westafrica-ebola.html">Robert Johnston</a>. This map seemed interesting to me and I decided to go about recreating it, with help from the MazamaSpatialUtils package by <a href="http://mazamascience.com">Mazama Science</a>. The map details the number of Ebola cases per 1,000 residents in each of the countries of Guinea, Sierra Leone, and Liberia. These cases are comprised of both confirmed and unconfirmed cases, as recorded by the World Health Organization. The data used for the graph was also given on the website.</p>
<div class="figure">
<img src="http://www.johnstonsarchive.net/policy/WAebola150509-map.gif">
</div>
</div>
<div id="preliminary-mapping" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminary-mapping" class="anchor"></a>Preliminary Mapping</h2>
<p>The first step in recreating this graph, after loading the appropriate data and setting my directory was to identify the border of each country from the TMWorldBorders data. This was done through taking a subset of the TMWorldBorders data that referred to the three countries of interest. The borders between the countries could then be plotted, with thicker lines used to further distinguish the borders.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MazamaSpatialUtils)</code></pre></div>
<pre><code>## Loading required package: sp</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)
<span class="kw"><a href="../../reference/setSpatialDataDir.html">setSpatialDataDir</a></span>(<span class="st">'~/Data/Spatial'</span>) <span class="co"># Use your own Spatial Data directory</span>
<span class="kw"><a href="../../reference/loadSpatialData.html">loadSpatialData</a></span>(<span class="st">'TMWorldBorders'</span>)
df &lt;-<span class="st"> </span>TMWorldBorders<span class="op">@</span>data
ebolaCountries &lt;-<span class="st"> </span><span class="kw">subset</span>(df,countryName <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">'Liberia'</span>, <span class="st">'Sierra Leone'</span>, <span class="st">'Guinea'</span>))
countryCodes =<span class="st"> </span>ebolaCountries[,<span class="dv">2</span>]
ebolaCountries &lt;-<span class="st"> </span><span class="kw">subset</span>(TMWorldBorders, countryName <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">'Liberia'</span>, <span class="st">'Sierra Leone'</span>, <span class="st">'Guinea'</span>))
<span class="kw">plot</span>(ebolaCountries, <span class="dt">lwd=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="ebolamap_files/figure-html/ebolaCountries-1.png" width="672"></p>
<p>The next step was to use the <code>convertGADM</code> function to download the required country data from the GADM database at the correct level. The map uses the provinces of Guinea (level 2), the provinces of Sierra Leone (level 2), and the counties of Liberia (level 1).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/convertGADM.html">convertGADM</a></span>(<span class="dt">countryCode=</span>countryCodes[<span class="dv">1</span>], <span class="dt">admLevel=</span><span class="dv">2</span>)
<span class="kw"><a href="../../reference/loadSpatialData.html">loadSpatialData</a></span>(<span class="st">'GADM_GN_2'</span>)
<span class="kw"><a href="../../reference/convertGADM.html">convertGADM</a></span>(<span class="dt">countryCode=</span>countryCodes[<span class="dv">2</span>], <span class="dt">admLevel=</span><span class="dv">1</span>)
<span class="kw"><a href="../../reference/loadSpatialData.html">loadSpatialData</a></span>(<span class="st">'GADM_LR_1'</span>)
<span class="kw"><a href="../../reference/convertGADM.html">convertGADM</a></span>(<span class="dt">countryCode=</span>countryCodes[<span class="dv">3</span>], <span class="dt">admLevel=</span><span class="dv">2</span>)
<span class="kw"><a href="../../reference/loadSpatialData.html">loadSpatialData</a></span>(<span class="st">'GADM_SL_2'</span>)</code></pre></div>
<p>Now that we have each country of interest divided into provinces/counties, we are ready to proceed to data acquisition regarding Ebola cases and their use in our map.</p>
</div>
<div id="acquiring-data" class="section level2">
<h2 class="hasAnchor">
<a href="#acquiring-data" class="anchor"></a>Acquiring Data</h2>
<p>Using <code>rvest</code>, we acquire the necessary Ebola counts per province/county in one central table. While the table also includes information for a 2014 population estimate and the total number of Ebola cases, we are solely interested in the column referring to cases/1000 pop as this is what we will be graphing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> "http://www.johnstonsarchive.net/policy/westafrica-ebola.html"</span>
raw &lt;-<span class="st"> </span>xml2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/xml2/topics/read_xml">read_html</a></span>(url)
tables &lt;-<span class="st"> </span>rvest<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rvest/topics/html_nodes">html_nodes</a></span>(raw, <span class="st">"table"</span>)
ebolaTable &lt;-<span class="st"> </span>rvest<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rvest/topics/html_table">html_table</a></span>(tables[[<span class="dv">3</span>]])</code></pre></div>
<p>Using this table, we can sort the cases/100 pop for each province/county into seven levels, which we pull from the original graph in order to achieve as close a copy as possible. Note that these levels are not linear. We also pull the colors used in the legend of the original graph, again with the goal of providing a close match to the original graph. We sort the data into these seven levels, with corresponding colors. We also add to the end an additional color, the color white, in order to take into account those values from the data which are NA (Values of NA indicate that there were 0 Ebola cases reported, resulting in a NA value for cases/100 pop).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">breaks &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">003</span>,.<span class="dv">01</span>,.<span class="dv">03</span>,.<span class="dv">1</span>,.<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">10</span>)
colorIndices &lt;-<span class="st"> </span><span class="kw">.bincode</span>(ebolaTable[<span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">16</span>,<span class="dv">20</span><span class="op">:</span><span class="dv">34</span>,<span class="dv">38</span><span class="op">:</span><span class="dv">78</span>),<span class="dv">4</span>], breaks)</code></pre></div>
<pre><code>## Warning in .bincode(ebolaTable[c(2:16, 20:34, 38:78), 4], breaks): NAs
## introduced by coercion</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">colorIndices[<span class="kw">is.na</span>(colorIndices)] &lt;-<span class="st"> </span><span class="dv">9</span>
colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'#8ed150'</span>,<span class="st">'#a2d840'</span>,<span class="st">'#c2e529'</span>,<span class="st">'#fdfd00'</span>,<span class="st">'#ffd600'</span>,<span class="st">'#ff8000'</span>,<span class="st">'#f40000'</span>,<span class="st">'#97547e'</span>,<span class="st">'#ffffff'</span>)</code></pre></div>
<p>Running this code gives us the error, “NAs introduced by coercion.” We can ignore this error, as we account for the NA values in the next line.</p>
</div>
<div id="applying-data-to-map" class="section level2">
<h2 class="hasAnchor">
<a href="#applying-data-to-map" class="anchor"></a>Applying Data to Map</h2>
<p>Now that we have sorted our data into categories, we can refer to our preliminary mappings to proceed in adding our chosen colors to the graph. As we have already labeled the data by level and assigned corresponding colors, we simply plot the GADM data for each country, adding the new plot on top of what we have already created. However, adding the colorization for each country has overridden the original borders between the countries, so we must add them back using our original plot containing only the country outlines, not the provinces/counties.</p>
<p>We are almost there! Our graph is looking very similar to the original graph, but it is missing a few crucial pieces. We add a legend defining our use of color, as well as labels for each country, and a title for the graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(GADM_GN_<span class="dv">2</span>, <span class="dt">col=</span>colors[colorIndices[<span class="dv">31</span><span class="op">:</span><span class="dv">71</span>]])
<span class="kw">plot</span>(GADM_LR_<span class="dv">1</span>, <span class="dt">col=</span>colors[colorIndices[<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>]], <span class="dt">add=</span><span class="ot">TRUE</span>)
<span class="kw">plot</span>(GADM_SL_<span class="dv">2</span>, <span class="dt">col=</span>colors[colorIndices[<span class="dv">16</span><span class="op">:</span><span class="dv">30</span>]], <span class="dt">add=</span><span class="ot">TRUE</span>)
<span class="kw">plot</span>(ebolaCountries, <span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)
<span class="kw">legend</span>(<span class="st">'bottomleft'</span>, <span class="dt">legend=</span><span class="kw">rev</span>(breaks[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>]), <span class="dt">fill=</span><span class="kw">rev</span>(colors[<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>]), <span class="dt">bty=</span><span class="st">'n'</span>, <span class="dt">title=</span><span class="st">'case rate per</span><span class="ch">\n</span><span class="st">1000 pop'</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridlines">text</a></span>(<span class="op">-</span><span class="fl">10.8</span>,<span class="fl">5.8</span>,<span class="st">'Liberia'</span>, <span class="dt">font=</span><span class="dv">2</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridlines">text</a></span>(<span class="op">-</span><span class="fl">14.1</span>,<span class="fl">7.8</span>,<span class="st">'Sierra Leone'</span>, <span class="dt">font=</span><span class="dv">2</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridlines">text</a></span>(<span class="op">-</span><span class="fl">14.8</span>,<span class="fl">9.8</span>,<span class="st">'Guinea'</span>, <span class="dt">font=</span><span class="dv">2</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridlines">text</a></span>(<span class="op">-</span><span class="fl">12.5</span>,<span class="fl">4.8</span>, <span class="st">'Rate of Ebola cases by region,</span><span class="ch">\n</span><span class="st">West Africa (to 22 Mar 2015)'</span>, <span class="dt">font=</span><span class="dv">2</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridlines">text</a></span>(<span class="op">-</span><span class="fl">12.5</span>, <span class="fl">4.3</span>,<span class="st">'(both confirmed and unconfirmed cases)'</span>, <span class="dt">cex=</span>.<span class="dv">8</span>, <span class="dt">xpd=</span><span class="ot">NA</span>)</code></pre></div>
<p><img src="ebolamap_files/figure-html/ebolaCaseRate-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="variations-between-the-graphs" class="section level2">
<h2 class="hasAnchor">
<a href="#variations-between-the-graphs" class="anchor"></a>Variations between the Graphs</h2>
<p>Our graph is very similar to the original graph, which we were trying to mimic. The main difference lies in the use of color. The original graph uses a continuous color scheme, providing a label for a limited number of the colors used. In contrast, our graph limits itself to six distinct colors, which are used both in the legend and in the graph itself.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#background">Background</a></li>
      <li><a href="#preliminary-mapping">Preliminary Mapping</a></li>
      <li><a href="#acquiring-data">Acquiring Data</a></li>
      <li><a href="#applying-data-to-map">Applying Data to Map</a></li>
      <li><a href="#variations-between-the-graphs">Variations between the Graphs</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Tom Bergamaschi, Ruby Fore, Will Leahy, Helen Miller, Henry Nguyen, Robin Winstanley, Alice Yang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
