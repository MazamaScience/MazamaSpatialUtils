<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to MazamaSpatialUtils • MazamaSpatialUtils</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to MazamaSpatialUtils">
<meta property="og:description" content="MazamaSpatialUtils">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MazamaSpatialUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/MazamaSpatialUtils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../articles/available-data.html">Available Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/MazamaSpatialUtils/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to MazamaSpatialUtils</h1>
                        <h4 data-toc-skip class="author">Mazama
Science</h4>
            
            <h4 data-toc-skip class="date">Nov 04, 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/MazamaSpatialUtils/blob/HEAD/vignettes/MazamaSpatialUtils.Rmd" class="external-link"><code>vignettes/MazamaSpatialUtils.Rmd</code></a></small>
      <div class="hidden name"><code>MazamaSpatialUtils.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The <strong>MazamaSpatialUtils</strong> package was created to
regularize work with spatial data. Many sources of shapefile data are
available and can be used to make beautiful maps in R. Unfortunately,
the data attached to these datasets, even when fairly complete, often
lacks standardized identifiers such as the ISO 3166-1 alpha-2 encodings
for countries. Maddeningly, even when these ISO codes are used, the
dataframe column in which they are stored does not have a standardized
name. It may be called “ISO” or “ISO2” or “alpha” or “COUNTRY” or any of
a dozen other names we have seen.</p>
<p>While many mapping packages provide <em>“natural”</em> naming of
countries, those who wish to develop operational, GIS-like systems need
something that is both standardized and language-independent. The ISO
3166-1 alpha-2 encodings have emerged as the <em>de facto</em> standard
for this sort of work. In similar fashion, ISO 3166-2 alpha-2 encodings
are available for the next administrative level down –
state/province/oblast, <em>etc.</em> For time zones, the <em>de
facto</em> standard is the set of Olson time zones used in all UNIX
systems.</p>
<p>The main goal of this package is to create an internally standardized
set of spatial data that can be used in various projects. Along with
three built-in datasets, this package provides <code>convert~()</code>
functions for other spatial datasets of interest. These convert
functions all follow the same recipe:</p>
<ul>
<li>download spatial data into a standard directory</li>
<li>convert spatial data into a <strong>sf</strong> simple features data
frame</li>
<li>modify the dataframe so that it adheres to package internal
standards</li>
</ul>
<p>Other datasets can be added following the same procedure.</p>
<p>The ‘package internal standards’ are very simple.</p>
<ol style="list-style-type: decimal">
<li>Every spatial dataset <strong>must</strong> contain the following
columns:</li>
</ol>
<ul>
<li>polygonID – unique identifier for each polygon</li>
<li>countryCode – country at centroid of polygon (ISO 3166-1
alpha-2)</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Spatial datasets with time zone data <strong>must</strong> contain
the following column:</li>
</ol>
<ul>
<li>timezone – Olson timezone</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Spatial datasets at scales smaller than the nation-state
<strong>should</strong> contain the following column:</li>
</ol>
<ul>
<li>stateCode – ‘state’ at centroid of polygon (ISO 3166-2 alpha-2)</li>
</ul>
<p>If other columns contain these data, those columns must be renamed or
duplicated with the internally standardized name. This simple level of
consistency makes it possible to generate maps for any data that is ISO
encoded. It also makes it possible to create functions that return the
country, state or time zone associated with a set of locations.</p>
</div>
<div class="section level2">
<h2 id="functionality">Functionality<a class="anchor" aria-label="anchor" href="#functionality"></a>
</h2>
<p>The core functionality for which this package was developed is
determining spatial information associated with a set of locations.</p>
<p>Current functionality includes the following:</p>
<ul>
<li>
<code>getCountry~(longitude, latitude, ...)</code> – returns names,
ISO codes and other country-level data at specified locations</li>
<li>
<code>getState~(longitude, latitude, ...)</code> – returns names,
ISO codes and other state-level at specified locations</li>
<li>
<code>getTimezone(longitude, latitude, ...)</code> – returns Olson
time zones and other data at specified locations</li>
<li>
<code>getUSCounty(longitude, latitude, ...)</code> – returns names
and other county-level data at specified locations</li>
</ul>
<p>A generic <code>getSpatialData(longitude, latitude, ...)</code>
returns a dataframe whose rows are associated with specified locations.
This function can be used with newly converted simple features data
frames.</p>
<p>For those working with geo-located data, the ability to enhance
location metadata with this information can be extremely helpful.</p>
</div>
<div class="section level2">
<h2 id="standard-datasets-and-setup">Standard Datasets and Setup<a class="anchor" aria-label="anchor" href="#standard-datasets-and-setup"></a>
</h2>
<p>When using <strong>MazamaSpatialUtils</strong>, always run
<code>setSpatialDataDir(&lt;spatial_data_directory&gt;)</code> first.
This sets the directory where spatial data will be installed and from
which it will be loaded. This can be a directory on a user’s personal
computer or perhaps a remotely mounted disk if huge spatial datasets are
going to be used.</p>
<p><strong>MazamaSpatialUtils</strong> has three built-in spatial
datasets:</p>
<ul>
<li>
<code>SimpleCountries</code> – country outlines</li>
<li>
<code>SimpleCountriesEEZ</code> – country outlines including
Exclusive Economic Zones over water</li>
<li>
<code>SimpleTimezones</code> – time zones</li>
</ul>
<p>Version 0.8 of the package is built around the three built-in
datasets and several other core datasets that may be installed
including:</p>
<ul>
<li>
<code>20 MB EEZCountries</code> – country boundaries including
Exclusive Economic Zones</li>
<li>
<code>5 MB EPARegions</code> – US EPA region boundaries</li>
<li>
<code>7 MB GACC</code> – Geographic Area Coordination Center (GACC)
boundaries</li>
<li>
<code>5 MB NaturalEarthAdm0</code> – country level boundaries<br>
</li>
<li>
<code>14 MB NaturalEarthAdm1</code> – state/province/oblast level
boundaries<br>
</li>
<li>
<code>99 MB OSMTimezones</code> – OpenStreetMap time zones</li>
<li>
<code>3 MB TMWorldBorders</code> – high resolution country level
boundaries</li>
<li>
<code>7 MB USCensus116thCongress</code> – 2019 US congressional
districts</li>
<li>
<code>34 MB USCensusCBSA</code> – US Core Based Statistical
Areas</li>
<li>
<code>12 MB USCensusCounties</code> – US county level
boundaries</li>
<li>
<code>3 MB USCensusStates</code> – US state level boundaries</li>
<li>
<code>23 MB WeatherZones</code> – US NWS public weather forecast
zones</li>
</ul>
<p>Install these one at a time with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setSpatialDataDir.html">setSpatialDataDir</a></span><span class="op">(</span><span class="st">'~/Data/Spatial_0.8'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/installSpatialData.html">installSpatialData</a></span><span class="op">(</span><span class="st">"&lt;datasetName&gt;"</span><span class="op">)</span></span></code></pre></div>
<p>Once datasets have been installed, <code><a href="../reference/loadSpatialData.html">loadSpatialData()</a></code> can
be used load datasets found in the <code>SpatialDataDir</code> that
match a particular pattern, <em>e.g</em>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loadSpatialData.html">loadSpatialData</a></span><span class="op">(</span><span class="st">'USCensusStates'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/loadSpatialData.html">loadSpatialData</a></span><span class="op">(</span><span class="st">'USCensusCounties'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getcountry-and-getcountrycode">
<code>getCountry()</code> and <code>getCountryCode()</code><a class="anchor" aria-label="anchor" href="#getcountry-and-getcountrycode"></a>
</h2>
<p>These two functions are used for assigning countries to one or many
locations. <code><a href="../reference/getCountry.html">getCountry()</a></code> returns English country names and
<code><a href="../reference/getCountryCode.html">getCountryCode()</a></code> returns the ISO-3166 two character country
code. Both functions can be passed <code>allData = TRUE</code> which
returns a dataframe with more information on the countries. You can also
specify <code>countryCodes = c(&lt;codes&gt;)</code> to speedup
searching by restricting the search to polygons associated within those
countries.</p>
<p>These functions use the package-internal <code>SimpleCountries</code>
dataset which can be used without loading any additional datasets.</p>
<p>In this example we’ll find the countries underneath a vector of
points:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/MazamaSpatialUtils" class="external-link">MazamaSpatialUtils</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: sf</span></span></code></pre>
<pre><code><span><span class="co">## Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122.3</span>, <span class="op">-</span><span class="fl">73.5</span>, <span class="fl">21.1</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">47.5</span>, <span class="fl">40.75</span>, <span class="fl">52.1</span>, <span class="fl">48.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get countries/codes associated with locations</span></span>
<span><span class="fu"><a href="../reference/getCountry.html">getCountry</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "United States" "United States" "Poland"        "France"</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getCountryCode.html">getCountryCode</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "US" "US" "PL" "FR"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Review all available data</span></span>
<span><span class="fu"><a href="../reference/getCountry.html">getCountry</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, allData <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   countryCode   countryName polygonID</span></span>
<span><span class="co">## 1          US United States       113</span></span>
<span><span class="co">## 2          US United States       113</span></span>
<span><span class="co">## 3          PL        Poland       205</span></span>
<span><span class="co">## 4          FR        France       167</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="getstate-and-getstatecode">
<code>getState()</code> and <code>getStateCode()</code><a class="anchor" aria-label="anchor" href="#getstate-and-getstatecode"></a>
</h2>
<p>Similar to above, these functions return state names and ISO 3166
codes. They also take the same arguments. Adding the
<code>countryCodes</code> argument is more important for
<code><a href="../reference/getState.html">getState()</a></code> and <code><a href="../reference/getStateCode.html">getStateCode()</a></code> because the
<code>NaturalEarthAdm1</code> dataset is fairly large.</p>
<p>These functions require installation of the large
<code>NaturalEarthAdm1</code> dataset which is not distributed with the
package.</p>
<p>(<em>The next block of code is not evaluated in the
vignette.</em>)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load states dataset if you haven't already</span></span>
<span><span class="fu"><a href="../reference/loadSpatialData.html">loadSpatialData</a></span><span class="op">(</span><span class="st">'NaturalEarthAdm1'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get country codes associated with locations</span></span>
<span><span class="va">countryCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCountryCode.html">getCountryCode</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pass the countryCodes as an argument to speed everything up</span></span>
<span><span class="fu"><a href="../reference/getState.html">getState</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, countryCodes <span class="op">=</span> <span class="va">countryCodes</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/getStateCode.html">getStateCode</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, countryCodes <span class="op">=</span> <span class="va">countryCodes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This is a very detailed dataset so we'll grab a few important columns</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getState.html">getState</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, allData <span class="op">=</span> <span class="cn">TRUE</span>, countryCodes <span class="op">=</span> <span class="va">countryCodes</span><span class="op">)</span></span>
<span><span class="va">states</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'countryCode'</span>, <span class="st">'stateCode'</span>, <span class="st">'stateName'</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gettimezone">
<code>getTimezone()</code><a class="anchor" aria-label="anchor" href="#gettimezone"></a>
</h2>
<p>Returns the Olsen time zone where the given points are located.
Arguments are the same as the previous functions.
<code>allData = TRUE</code> will return other useful information such as
the UTC Offset.</p>
<p>These functions use the package-internal <code>SimpleTimezones</code>
dataset which can be used without loading any additional datasets.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the time zones the points are in</span></span>
<span><span class="fu"><a href="../reference/getTimezone.html">getTimezone</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "America/Los_Angeles" "America/New_York"    "Europe/Warsaw"      </span></span>
<span><span class="co">## [4] "Europe/Paris"</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get country codes associated with locations</span></span>
<span><span class="va">countryCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCountryCode.html">getCountryCode</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pass the countryCodes as an argument to potentially speed things up</span></span>
<span><span class="fu"><a href="../reference/getTimezone.html">getTimezone</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, countryCodes <span class="op">=</span> <span class="va">countryCodes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "America/Los_Angeles" "America/New_York"    "Europe/Warsaw"      </span></span>
<span><span class="co">## [4] "Europe/Paris"</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Review all available data</span></span>
<span><span class="fu"><a href="../reference/getTimezone.html">getTimezone</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, allData <span class="op">=</span> <span class="cn">TRUE</span>, countryCodes <span class="op">=</span> <span class="va">countryCodes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              timezone countryCode countryCodes timezone_STD_abbreviation</span></span>
<span><span class="co">## 1 America/Los_Angeles          US           US                       PST</span></span>
<span><span class="co">## 2    America/New_York          US           US                       EST</span></span>
<span><span class="co">## 3       Europe/Warsaw          PL           PL                       CET</span></span>
<span><span class="co">## 4        Europe/Paris          FR       FR, MC                       CET</span></span>
<span><span class="co">##   timezone_DST_abbreviation UTC_STD_offset UTC_DST_offset notes polygonID</span></span>
<span><span class="co">## 1                       PDT             -8             -7             133</span></span>
<span><span class="co">## 2                       EDT             -5             -4             152</span></span>
<span><span class="co">## 3                      CEST              1              2             369</span></span>
<span><span class="co">## 4                      CEST              1              2             348</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="getuscounty">
<code>getUSCounty()</code><a class="anchor" aria-label="anchor" href="#getuscounty"></a>
</h2>
<p>Returns the US County which name pairs of coordinates fall in. The
arguments are similar as above except that <code>stateCodes=c()</code>
is used instead of <code>countryCodes=c()</code> since this dataset is
US specific.</p>
<p>(<em>The next block of code is not evaluated in the
vignette.</em>)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load counties dataset if you haven't already</span></span>
<span><span class="fu"><a href="../reference/loadSpatialData.html">loadSpatialData</a></span><span class="op">(</span><span class="st">"USCensusCounties"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># New dataset of points only in the US</span></span>
<span><span class="va">stateCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getStateCode.html">getStateCode</a></span><span class="op">(</span><span class="va">longitude</span>,<span class="va">latitude</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optionally pass the stateCodes as an argument to speed everything up</span></span>
<span><span class="fu"><a href="../reference/getUSCounty.html">getUSCounty</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, stateCodes <span class="op">=</span> <span class="va">stateCodes</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/getUSCounty.html">getUSCounty</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, allData <span class="op">=</span> <span class="cn">TRUE</span>, stateCodes <span class="op">=</span> <span class="va">stateCodes</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="timezone-map">Timezone Map<a class="anchor" aria-label="anchor" href="#timezone-map"></a>
</h2>
<p>While identifying the states, countries and time zones associated
with a set of locations is important, we can also generate some quick
eye candy with these datasets. Let’s color the time zones by the data
variable ‘UTC_offset’</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign time zones polygons an index based on UTC_offset</span></span>
<span><span class="va">colorIndices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bincode.html" class="external-link">.bincode</a></span><span class="op">(</span><span class="va">SimpleTimezones</span><span class="op">$</span><span class="va">UTC_STD_offset</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">12.5</span>,<span class="fl">12.5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Color our time zones by UTC_offset</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SimpleTimezones</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span><span class="op">[</span><span class="va">colorIndices</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>line <span class="op">=</span> <span class="fl">0</span>, <span class="st">'Timezone Offsets from UTC'</span><span class="op">)</span></span></code></pre></div>
<p><img src="MazamaSpatialUtils_files/figure-html/timezoneMap-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="working-with-iso-3166-1-encoded-data">Working with ISO 3166-1 Encoded Data<a class="anchor" aria-label="anchor" href="#working-with-iso-3166-1-encoded-data"></a>
</h2>
<p>On of the main reasons for ensuring that our spatial datasets use ISO
encoding is that it makes it easy to generate plots with any datasets
that use that encoding. Here is a slightly more involved example using
Energy data from the British Petroleum Statistical Review that has been
ISO-encoded.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>         <span class="co"># For spatial plotting</span></span>
<span></span>
<span><span class="co"># Read in ISO-encoded oil production and consumption data</span></span>
<span><span class="va">prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">'http://mazamascience.com/OilExport/BP_2016_oil_production_bbl.csv'</span><span class="op">)</span>,</span>
<span>                 skip <span class="op">=</span> <span class="fl">6</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, na.strings <span class="op">=</span> <span class="st">'na'</span><span class="op">)</span></span>
<span><span class="va">cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">'http://mazamascience.com/OilExport/BP_2016_oil_consumption_bbl.csv'</span><span class="op">)</span>,</span>
<span>                 skip <span class="op">=</span> <span class="fl">6</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, na.strings <span class="op">=</span> <span class="st">'na'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only work with ISO-encoded columns of data</span></span>
<span><span class="va">prodCountryCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prod</span><span class="op">)</span><span class="op">[</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html" class="external-link">str_length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prod</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">]</span></span>
<span><span class="va">consCountryCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cons</span><span class="op">)</span><span class="op">[</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html" class="external-link">str_length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cons</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">]</span></span>
<span></span>
<span><span class="co"># Use the last row (most recent data)</span></span>
<span><span class="va">lastRow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">prod</span><span class="op">)</span></span>
<span><span class="va">year</span> <span class="op">&lt;-</span> <span class="va">prod</span><span class="op">$</span><span class="va">YEAR</span><span class="op">[</span><span class="va">lastRow</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Neither dataframe contains all countries so create four categories based on the</span></span>
<span><span class="co"># amount of information we have:  netExporters, netImporters, exportOnly, importOnly</span></span>
<span><span class="va">sharedCountryCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">prodCountryCodes</span>,<span class="va">consCountryCodes</span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="va">prod</span><span class="op">[</span><span class="va">lastRow</span>, <span class="va">sharedCountryCodes</span><span class="op">]</span> <span class="op">-</span> <span class="va">cons</span><span class="op">[</span><span class="va">lastRow</span>, <span class="va">sharedCountryCodes</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Find codes associated with each category</span></span>
<span><span class="va">netExportCodes</span> <span class="op">&lt;-</span> <span class="va">sharedCountryCodes</span><span class="op">[</span><span class="va">net</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">netImportCodes</span> <span class="op">&lt;-</span> <span class="va">sharedCountryCodes</span><span class="op">[</span><span class="va">net</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">exportOnlyCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">prodCountryCodes</span>,<span class="va">consCountryCodes</span><span class="op">)</span></span>
<span><span class="va">importOnlyCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">consCountryCodes</span>,<span class="va">prodCountryCodes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a logical 'mask' associated with each category</span></span>
<span><span class="va">netExportMask</span> <span class="op">&lt;-</span> <span class="va">SimpleCountries</span><span class="op">$</span><span class="va">countryCode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">netExportCodes</span></span>
<span><span class="va">netImportMask</span> <span class="op">&lt;-</span> <span class="va">SimpleCountries</span><span class="op">$</span><span class="va">countryCode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">netImportCodes</span></span>
<span><span class="va">onlyExportMask</span> <span class="op">&lt;-</span> <span class="va">SimpleCountries</span><span class="op">$</span><span class="va">countryCode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">exportOnlyCodes</span></span>
<span><span class="va">onlyImportMask</span> <span class="op">&lt;-</span> <span class="va">SimpleCountries</span><span class="op">$</span><span class="va">countryCode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">importOnlyCodes</span></span>
<span></span>
<span><span class="va">color_export</span> <span class="op">=</span> <span class="st">'#40CC90'</span></span>
<span><span class="va">color_import</span> <span class="op">=</span> <span class="st">'#EE5555'</span></span>
<span><span class="va">color_missing</span> <span class="op">=</span> <span class="st">'gray90'</span></span>
<span></span>
<span><span class="co"># Base plot (without Antarctica)</span></span>
<span><span class="va">notAQ</span> <span class="op">&lt;-</span> <span class="va">SimpleCountries</span><span class="op">$</span><span class="va">countryCode</span> <span class="op">!=</span> <span class="st">'AQ'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SimpleCountries</span><span class="op">[</span><span class="va">notAQ</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="va">color_missing</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SimpleCountries</span><span class="op">[</span><span class="va">netExportMask</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="va">color_export</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SimpleCountries</span><span class="op">[</span><span class="va">onlyExportMask</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="va">color_export</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SimpleCountries</span><span class="op">[</span><span class="va">netImportMask</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="va">color_import</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SimpleCountries</span><span class="op">[</span><span class="va">onlyImportMask</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="va">color_import</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>  <span class="st">'bottomleft'</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Net Exporters'</span>,<span class="st">'Net Importers'</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">color_export</span>,<span class="va">color_import</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>line <span class="op">=</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'World Crude Oil in'</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="MazamaSpatialUtils_files/figure-html/netExport-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jonathan Callahan, Rachel Carroll, Eli Grosman, Roger Andre, Tom Bergamaschi, Tina Chen, Ruby Fore, Will Leahy, Helen Miller, Henry Nguyen, Robin Winstanley, Alice Yang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
